!function(t,e,r){function n(t,e,r){this.route=t,this.handlers=e,this.cortex=r}function o(){this.middlewares=[],this.routes=[]}n.prototype.tokenizeQueryString=function(t){if(t=t||"",!t.length||1==t.length&&"?"==t[0])return{};t=t.replace(/^\?/,""),t=t.split("&");var e={};return r.reduce(t,function(t,r){return r=r.split("="),e[r[0]]=r[1],e},e),e},n.prototype.tokenizeUrlParams=function(t){var e={};t=r.filter(t,function(t){return!!t});var n=r.map(this.route.match(/(:[^\/]+)/g),function(t){return t.substring(1).replace(/[\(\)]/g,"")});return r.reduce(n,function(e,r,n){return e[r]=t[n]||void 0,e},e),e||{}},n.prototype.getHandler=function(){var t=this;return function(){var e=[].concat(t.cortex.getMiddlewares()).concat(t.handlers);if(e.length){var n=r.values(arguments),o={query:t.tokenizeQueryString(n.pop()),params:t.tokenizeUrlParams(n),Route:t,data:{}},u=function(){if(!e.length)return t.cortex.trigger("afterRoute",o);var r=e.shift();if("function"==typeof r)try{r(o,function(e){return e?t.cortex.trigger("error",e,o,t):(u(),void 0)})}catch(n){t.cortex.trigger("error",n,o,t)}};u()}}},n.prototype.getRoute=function(){return this.route},o.prototype=Object.create(Backbone.Events),o.prototype.use=function(t){"function"==typeof t&&this.middlewares.push(t)},o.prototype.getMiddlewares=function(){return this.middlewares||[]},o.prototype.route=function(t){var e=r.values(arguments);return e.length<2?console.warn("Missing arguments; Cortex.route(route, fn)"):(this.routes.push(new n(t,e.slice(1),this)),void 0)},o.prototype.getRoutes=function(){var t={};return r.reduce(this.routes,function(t,e){return t[e.getRoute()]=e.getHandler(),t},t),t},t.Cortex=o}(window,jQuery,_);