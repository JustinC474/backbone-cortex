!function(t,e,r){function n(t,e,r,n){this.route=t,this.options=e||{},this.handlers=r,this.cortex=n}function o(){this.middlewares=[],this.routes=[]}n.prototype.tokenizeQueryString=function(t){if(t=t||"",!t.length||1==t.length&&"?"==t[0])return{};t=t.replace(/^\?/,""),t=t.split("&");var e={};return r.reduce(t,function(t,r){return r=r.split("="),e[r[0]]=r[1],e},e),e},n.prototype.getOptions=function(){return this.options||{}},n.prototype.tokenizeUrlParams=function(t){var e={};t=r.filter(t,function(t){return!!t});var n=r.map(this.route.match(/(:[^\/]+)/g),function(t){return t.substring(1).replace(/[\(\)]/g,"")});return r.reduce(n,function(e,r,n){return e[r]=t[n]||void 0,e},e),e||{}},n.prototype.getHandler=function(){var t=this;return function(){var e=[].concat(t.cortex.getMiddlewares()).concat(t.handlers);if(e.length){var n=r.values(arguments),o={query:t.tokenizeQueryString(n.pop()),params:t.tokenizeUrlParams(n),options:t.getOptions(),Route:t,data:{}},i=function(){if(!e.length)return t.cortex.trigger("afterRoute",o);var r=e.shift();if("function"==typeof r)try{r(o,function(e){return e?t.cortex.trigger("error",e,o,t):(i(),void 0)})}catch(n){t.cortex.trigger("error",n,o,t)}};i()}}},n.prototype.getRoute=function(){return this.route},o.prototype=Object.create(Backbone.Events),o.prototype.use=function(t){"function"==typeof t&&this.middlewares.push(t)},o.prototype.getMiddlewares=function(){return this.middlewares||[]},o.prototype.route=function(t){var e=r.values(arguments);if(e.length<2||2==e.length&&r.isPlainObject(e[1]))return console.warn("Missing arguments; Cortex.route(route[, options], fn...)");var o={};r.isPlainObject(e[1])&&(o=e[1],e=e.slice(1)),this.routes.push(new n(t,o,e.slice(1),this))},o.prototype.getRoutes=function(){var t={};return r.reduce(this.routes,function(t,e){return t[e.getRoute()]=e.getHandler(),t},t),t},t.Cortex=o}(window,jQuery,_);